{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/四方世界/脚本/成长系统/index.ts"],"sourcesContent":["(async function () {\n  'use strict';\n  if (typeof (window as any).waitGlobalInitialized === 'function') {\n    await (window as any).waitGlobalInitialized('Mvu');\n  }\n\n  const EVT = (window as any).Mvu?.events || {};\n  const EVENT_STARTED = EVT.VARIABLE_UPDATE_STARTED || 'mag_variable_update_started';\n  const EVENT_ENDED = EVT.VARIABLE_UPDATE_ENDED || 'mag_variable_update_ended';\n\n  const eventOnFn = typeof (window as any).eventOn === 'function' ? (window as any).eventOn : () => {};\n\n  let prevMoneySnapshot: any = null;\n  eventOnFn(EVENT_STARTED, function (variables: any) {\n    const money = variables?.stat_data?.主角?.背包?.金钱;\n    if (money) {\n      try {\n        prevMoneySnapshot = JSON.parse(JSON.stringify(money));\n      } catch (e) {\n        prevMoneySnapshot = null;\n      }\n    }\n  });\n\n  function pushMessage(variables: any, key: string, msg: string) {\n    if (!variables) return;\n    if (!variables.display_data) variables.display_data = {};\n    variables.display_data[key] = (variables.display_data[key] ? variables.display_data[key] + '\\n' : '') + msg;\n  }\n\n  function num(v: any) {\n    const n = parseFloat(v);\n    return isNaN(n) ? 0 : n;\n  }\n\n  function findItem(owner: any, name: string) {\n    if (!owner || !name) return null;\n    const bag = owner.背包;\n    const catKeys = ['武器', '防具', '饰品', '消耗品', '材料', '杂物'];\n    if (bag && typeof bag === 'object') {\n      for (const c of catKeys) {\n        const bucket = bag[c];\n        if (bucket && typeof bucket === 'object' && Object.prototype.hasOwnProperty.call(bucket, name))\n          return bucket[name];\n      }\n    }\n    return null;\n  }\n\n  function migrateFatigue(stat: any) {\n    const p = stat?.主角;\n    if (p && p.疲劳度) {\n      p.体力值 = p.体力值 || {};\n      if (p.体力值.当前值 == null && p.疲劳度.当前值 != null) p.体力值.当前值 = p.疲劳度.当前值;\n      if (p.体力值.最大值 == null && p.疲劳度.最大值 != null) p.体力值.最大值 = p.疲劳度.最大值;\n      delete p.疲劳度;\n    }\n    if (stat.关系列表 && typeof stat.关系列表 === 'object') {\n      for (const name in stat.关系列表) {\n        const npc = stat.关系列表[name];\n        if (npc && npc.疲劳度) {\n          npc.体力值 = npc.体力值 || {};\n          if (npc.体力值.当前值 == null && npc.疲劳度.当前值 != null) npc.体力值.当前值 = npc.疲劳度.当前值;\n          if (npc.体力值.最大值 == null && npc.疲劳度.最大值 != null) npc.体力值.最大值 = npc.疲劳度.最大值;\n          delete npc.疲劳度;\n        }\n      }\n    }\n  }\n\n  const JOB_LEVEL_XP_TABLE: Record<number, number> = {\n    1: 1000, 2: 1500, 3: 2500, 4: 4000, 5: 6000,\n    6: 9000, 7: 13000, 8: 20000, 9: 30000, 10: 50000,\n  };\n  const EXP_MULT = 1.5;\n  function sharedExperienceGrowth(stat: any, msgOut: string[]) {\n    const p = stat?.主角;\n    if (!p || !p.职业经验 || typeof p.职业 !== 'object' || p.经验等级 == null || p.职业点数 == null) return;\n    while (num(p.职业经验.当前值) >= num(p.职业经验.升级所需)) {\n      const req = num(p.职业经验.升级所需);\n      if (req <= 0) break;\n      p.职业经验.当前值 = num(p.职业经验.当前值) - req;\n      p.经验等级 = parseInt(p.经验等级, 10) + 1;\n      p.职业点数 = parseInt(p.职业点数, 10) + 1;\n      p.职业经验.升级所需 = JOB_LEVEL_XP_TABLE[p.经验等级] || Math.round(req * EXP_MULT);\n      msgOut.push(`经验等级提升至 ${p.经验等级} 级！获得 1 技能点！`);\n    }\n  }\n\n  function attributeBreakthrough(stat: any, msgOut: string[]) {\n    const p = stat?.主角;\n    if (!p || !p.历练进度 || !p.能力) return;\n    for (const a in p.历练进度) {\n      const progress = num(p.历练进度[a]);\n      const threshold = 100;\n\n      if (progress < threshold) continue;\n      const k = Math.floor(progress / threshold);\n      if (k <= 0) continue;\n\n      p.历练进度[a] = progress - k * threshold;\n\n      if (p.能力[a] != null) {\n        p.能力[a] = num(p.能力[a]) + k;\n        // 同步增加资源当前值，保持与最大值的增幅一致\n        if (a === '力量') {\n          p.生命值 = p.生命值 || { 当前值: 0, 最大值: 0 };\n          p.生命值.当前值 = num(p.生命值.当前值) + 5 * k;\n          p.体力值 = p.体力值 || { 当前值: 0, 最大值: 0 };\n          p.体力值.当前值 = num(p.体力值.当前值) + 1 * k;\n        }\n        if (a === '感知') {\n          p.生命值 = p.生命值 || { 当前值: 0, 最大值: 0 };\n          p.生命值.当前值 = num(p.生命值.当前值) + 2 * k;\n        }\n        if (a === '敏捷') {\n          p.体力值 = p.体力值 || { 当前值: 0, 最大值: 0 };\n          p.体力值.当前值 = num(p.体力值.当前值) + 1 * k;\n        }\n        if (a === '魔力') {\n          p.魔力值 = p.魔力值 || { 当前值: 0, 最大值: 0 };\n          p.魔力值.当前值 = num(p.魔力值.当前值) + 1 * k;\n        }\n        if (a === '信仰力') {\n          p.信仰力值 = p.信仰力值 || { 当前值: 0, 最大值: 0 };\n          p.信仰力值.当前值 = num(p.信仰力值.当前值) + 1 * k;\n        }\n        msgOut.push(`【${a}】属性突破！提升至 ${p.能力[a]}！(×${k})`);\n      }\n    }\n  }\n\n  const SKILL_LEVELS = ['初级', '中级', '高级', '精通', '大师'];\n  const SKILL_MULT = 1.5;\n  function skillLevelUp(stat: any, msgOut: string[]) {\n    const p = stat?.主角;\n    if (!p || !p.技能列表) return;\n    for (const name in p.技能列表) {\n      const sk = p.技能列表[name];\n      if (!sk || !sk.经验 || typeof sk.等级 !== 'string' || SKILL_LEVELS.indexOf(sk.等级) < 0) continue;\n      while (num(sk.经验.当前值) >= num(sk.经验.升级所需)) {\n        const req = num(sk.经验.升级所需);\n        if (req <= 0) break;\n        const idx = SKILL_LEVELS.indexOf(sk.等级);\n        if (idx >= SKILL_LEVELS.length - 1) break;\n        const nxt = SKILL_LEVELS[idx + 1];\n        sk.经验.当前值 = num(sk.经验.当前值) - req;\n        sk.等级 = nxt;\n        sk.经验.升级所需 = Math.round(req * SKILL_MULT);\n        msgOut.push(`技能【${name}】提升至【${nxt}】！`);\n      }\n    }\n  }\n\n  function capValues(stat: any) {\n    const p = stat?.主角;\n    if (!p) return;\n    for (const res of ['生命值', '魔力值', '信仰力值', '体力值', '护甲值']) {\n      const r = p[res];\n      if (r && r.当前值 != null && r.最大值 != null) {\n        const cur = num(r.当前值);\n        const max = num(r.最大值);\n        if (isFinite(max) && cur > max) r.当前值 = max;\n      }\n    }\n  }\n\n  function cleanupEquip(ch: any) {\n    if (!ch || !ch.装备) return;\n    const equip = ch.装备;\n    ['武器', '防具', '饰品'].forEach(cat => {\n      if (equip[cat] && typeof equip[cat] === 'object') {\n        Object.entries(equip[cat]).forEach(([slotKey, slotVal]) => {\n          if (typeof slotVal === 'string') {\n            if (!findItem(ch, slotVal)) delete equip[cat][slotKey];\n          }\n        });\n      }\n    });\n  }\n\n  function twoHandRule(ch: any) {\n    if (!ch || !ch.装备) return;\n    const weapons = ch.装备.武器 || {};\n    let hasTwoHanded = false;\n    Object.values(weapons).forEach((weapon: any) => {\n      const item = typeof weapon === 'string' ? findItem(ch, weapon) : weapon;\n      if (item && String(item.hands || '').trim() === '双手') {\n        hasTwoHanded = true;\n      }\n    });\n    // 简单的双持互斥：如果有双手武器，清空除该武器外的其他武器\n    if (hasTwoHanded) {\n      const newWeapons: any = {};\n      Object.entries(weapons).forEach(([k, v]: [string, any]) => {\n        const item = typeof v === 'string' ? findItem(ch, v) : v;\n        if (item && String(item.hands || '').trim() === '双手') newWeapons[k] = v;\n      });\n      ch.装备.武器 = newWeapons;\n    }\n  }\n\n  function totalAbilities(ch: any) {\n    if (!ch || !ch.能力) return;\n    const A = ['力量', '敏捷', '感知', '知识', '魅力', '魔力', '信仰力'];\n    const equip = ch.装备 || {};\n    const states = ch.当前状态 || {};\n\n    function itemBonus(slot: any, a: string) {\n      if (!slot) return 0;\n      if (typeof slot === 'object' && slot !== null) {\n        return slot.attributes_bonus ? num(slot.attributes_bonus[a]) : 0;\n      }\n      const item = findItem(ch, slot);\n      return item?.attributes_bonus ? num(item.attributes_bonus[a]) : 0;\n    }\n\n    for (const a of A) {\n      let t = num(ch.能力[a] ?? 0);\n      // 遍历所有装备分类下的所有物品\n      ['武器', '防具', '饰品'].forEach(cat => {\n        if (equip[cat]) {\n          Object.values(equip[cat]).forEach(item => {\n            t += itemBonus(item, a);\n          });\n        }\n      });\n      for (const sName in states) {\n        const st = states[sName];\n        if (st?.attributes_bonus?.[a]) t += num(st.attributes_bonus[a]);\n      }\n      ch.能力[a] = Math.max(1, t);\n    }\n  }\n\n  function resourceMax(ch: any) {\n    if (!ch || !ch.能力) return;\n    const hpMax = 10 + num(ch.能力.力量) * 5 + num(ch.能力.感知) * 2;\n    ch.生命值 = ch.生命值 || { 当前值: 0, 最大值: 0 };\n    if (ch.生命值.最大值 !== hpMax) {\n      ch.生命值.最大值 = hpMax;\n      if (num(ch.生命值.当前值) > hpMax) ch.生命值.当前值 = hpMax;\n    }\n\n    const mpMax = num(ch.能力.魔力);\n    ch.魔力值 = ch.魔力值 || { 当前值: 0, 最大值: 0 };\n    if (ch.魔力值.最大值 !== mpMax) {\n      ch.魔力值.最大值 = mpMax;\n      if (num(ch.魔力值.当前值) > mpMax) ch.魔力值.当前值 = mpMax;\n    }\n\n    const fpMax = num(ch.能力.信仰力);\n    ch.信仰力值 = ch.信仰力值 || { 当前值: 0, 最大值: 0 };\n    if (ch.信仰力值.最大值 !== fpMax) {\n      ch.信仰力值.最大值 = fpMax;\n      if (num(ch.信仰力值.当前值) > fpMax) ch.信仰力值.当前值 = fpMax;\n    }\n\n    const spMax = 5 + num(ch.能力.敏捷) + num(ch.能力.力量);\n    ch.体力值 = ch.体力值 || { 当前值: 0, 最大值: 0 };\n    if (ch.体力值.最大值 !== spMax) {\n      ch.体力值.最大值 = spMax;\n      if (num(ch.体力值.当前值) > spMax) ch.体力值.当前值 = spMax;\n    }\n\n    let armor = 0;\n    const equip = ch.装备 || {};\n    function armorOf(slot: any) {\n      if (!slot) return 0;\n      if (typeof slot === 'object' && slot !== null) return num(slot?.armor_value);\n      const item = findItem(ch, slot);\n      return num(item?.armor_value);\n    }\n    // 遍历计算所有护甲\n    ['武器', '防具', '饰品'].forEach(cat => {\n        if (equip[cat]) {\n            Object.values(equip[cat]).forEach(item => {\n                armor += armorOf(item);\n            });\n        }\n    });\n\n    ch.护甲值 = ch.护甲值 || { 当前值: 0, 最大值: 0 };\n    if (ch.护甲值.最大值 !== armor) {\n      ch.护甲值.最大值 = armor;\n      if (num(ch.护甲值.当前值) > armor) ch.护甲值.当前值 = armor;\n    }\n  }\n\n  const FATIGUE = { slightly: 0.75, tired: 0.5, over: 0.2 };\n  function fatigueStates(ch: any) {\n    if (!ch || !ch.体力值 || ch.体力值.最大值 == null || ch.体力值.当前值 == null) return;\n    const ratio = num(ch.体力值.当前值) / Math.max(1, num(ch.体力值.最大值));\n    let target = null;\n    if (ratio <= FATIGUE.over) target = '过度疲劳';\n    else if (ratio <= FATIGUE.tired) target = '疲劳';\n    else if (ratio <= FATIGUE.slightly) target = '有点累';\n    ch.当前状态 = ch.当前状态 || {};\n    const have = {\n      slight: !!ch.当前状态['有点累'],\n      tired: !!ch.当前状态['疲劳'],\n      over: !!ch.当前状态['过度疲劳'],\n    };\n    if (target !== '有点累' && have.slight) delete ch.当前状态['有点累'];\n    if (target !== '疲劳' && have.tired) delete ch.当前状态['疲劳'];\n    if (target !== '过度疲劳' && have.over) delete ch.当前状态['过度疲劳'];\n    if (target && !ch.当前状态[target]) {\n      const desc: Record<string, string> = {\n        有点累: '体力下降，注意节奏。对检定略有影响。',\n        疲劳: '明显疲惫，动作迟缓。对检定有中等减益。',\n        过度疲劳: '极度疲乏，注意休息！对检定有显著减益，易入睡。',\n      };\n      const rollMod: Record<string, number> = { 有点累: -1, 疲劳: -2, 过度疲劳: -4 };\n      ch.当前状态[target] = {\n        type: '临时',\n        level: '1',\n        description: desc[target],\n        attributes_bonus: {},\n        special_effects: { roll_modifier: rollMod[target] },\n      };\n    }\n  }\n\n  const COPPER_PER_SILVER = 100;\n  const SILVER_PER_GOLD = 100;\n  function purchaseConversion(stat: any, variables: any) {\n    const money = stat?.主角?.背包?.金钱;\n    if (!money) return;\n\n    let g = num(money.金币), s = num(money.银币), c = num(money.铜币);\n    if (g < 0) {\n      const deficit = -g;\n      const needS = deficit * SILVER_PER_GOLD;\n      const usableS = Math.max(0, s);\n      const shortageS = Math.max(0, needS - usableS);\n      const needCforS = shortageS * COPPER_PER_SILVER;\n      if (c >= needCforS) {\n        if (needCforS > 0) {\n          money.铜币 = c - needCforS;\n          money.银币 = s + shortageS;\n          c = money.铜币;\n          s = money.银币;\n        }\n        money.银币 = s - needS;\n        money.金币 = g + deficit;\n        pushMessage(variables, '交易提示', `购买成功：用 ${needS} 银币（不足部分用 ${needCforS} 铜币换得）抵扣 ${deficit} 金币`);\n      } else {\n        pushMessage(variables, '交易提示', `购买失败：金币不足，且银/铜不足以按需换算（缺少 ${deficit} 金）。已取消金币扣费`);\n        if (prevMoneySnapshot) money.金币 = prevMoneySnapshot.金币;\n        else money.金币 = g + deficit;\n      }\n    }\n\n    g = num(money.金币); s = num(money.银币); c = num(money.铜币);\n    if (s < 0) {\n      const deficitS = -s;\n      const needG = Math.ceil(deficitS / SILVER_PER_GOLD);\n      if (needG > 0 && money.金币 >= needG) {\n        money.金币 = money.金币 - needG;\n        money.银币 = s + needG * SILVER_PER_GOLD;\n        pushMessage(variables, '交易提示', `购买成功：用 ${needG} 金币换得 ${needG * SILVER_PER_GOLD} 银币抵扣 ${deficitS} 银币`);\n      } else {\n        const needC = deficitS * COPPER_PER_SILVER;\n        if (money.铜币 >= needC) {\n          money.铜币 = c - needC;\n          money.银币 = s + deficitS;\n          pushMessage(variables, '交易提示', `购买成功：消耗 ${needC} 铜币抵扣 ${deficitS} 银币（自动换算）`);\n        } else {\n          pushMessage(variables, '交易提示', `购买失败：银币不足，且金币/铜币不足以按需换算（缺少 ${deficitS} 银）。已取消银币扣费`);\n          if (prevMoneySnapshot) money.银币 = prevMoneySnapshot.银币;\n          else money.银币 = s + deficitS;\n        }\n      }\n    }\n\n    c = num(money.铜币); s = num(money.银币);\n    if (c < 0) {\n      const deficitC = -c;\n      const needSforC = Math.ceil(deficitC / COPPER_PER_SILVER);\n      if (needSforC > 0 && money.银币 >= needSforC) {\n        money.银币 = money.银币 - needSforC;\n        money.铜币 = c + needSforC * COPPER_PER_SILVER;\n        pushMessage(variables, '交易提示', `购买成功：用 ${needSforC} 银币换得 ${needSforC * COPPER_PER_SILVER} 铜币抵扣 ${deficitC} 铜币`);\n      } else {\n        pushMessage(variables, '交易提示', `购买失败：铜币不足，且银币不足以按需换算（缺少 ${deficitC} 铜）。已取消铜币扣费`);\n        if (prevMoneySnapshot) money.铜币 = prevMoneySnapshot.铜币;\n        else money.铜币 = c + deficitC;\n      }\n    }\n  }\n\n  function normalizeCoordinates(stat: any) {\n    const pcoord = stat?.主角?.坐标;\n    if (pcoord) {\n      // 保持\n    }\n    const wps = stat?.地图位标;\n    if (wps && typeof wps === 'object') {\n      for (const name in wps) {\n        const wp = wps[name];\n        if (!wp || typeof wp !== 'object') continue;\n        if (wp.临时 === true) wps[name] = null;\n      }\n    }\n  }\n\n  function cleanupDeadEnemies(stat: any) {\n    const root = stat?.敌人列表;\n    if (!root || typeof root !== 'object') return;\n    for (const name in root) {\n      const hp = num(root[name]?.生命值?.当前值);\n      if (isFinite(hp) && hp <= 0) root[name] = null;\n    }\n  }\n\n  function deferredCleanup(stat: any) {\n    const wps = stat?.地图位标;\n    if (wps && typeof wps === 'object') {\n      for (const name in wps) if (wps[name] === null) delete wps[name];\n    }\n    const enemies = stat?.敌人列表;\n    if (enemies && typeof enemies === 'object') {\n      for (const name in enemies) if (enemies[name] === null) delete enemies[name];\n    }\n  }\n\n  function onVariableUpdateEnded(variables: any) {\n    if (!variables || !variables.stat_data) return;\n    const stat = variables.stat_data;\n    const growMsgs: string[] = [];\n    try {\n      deferredCleanup(stat);\n      migrateFatigue(stat);\n      sharedExperienceGrowth(stat, growMsgs);\n      attributeBreakthrough(stat, growMsgs);\n      skillLevelUp(stat, growMsgs);\n      capValues(stat);\n      if (stat.主角) {\n        cleanupEquip(stat.主角);\n        twoHandRule(stat.主角);\n        totalAbilities(stat.主角);\n        resourceMax(stat.主角);\n        fatigueStates(stat.主角);\n      }\n      if (stat.关系列表 && typeof stat.关系列表 === 'object') {\n        for (const name in stat.关系列表) {\n          const npc = stat.关系列表[name];\n          if (npc && npc.在场 === true) {\n            cleanupEquip(npc);\n            twoHandRule(npc);\n            totalAbilities(npc);\n            resourceMax(npc);\n            fatigueStates(npc);\n            capValues({ 主角: npc }); \n          }\n        }\n      }\n      purchaseConversion(stat, variables);\n      normalizeCoordinates(stat);\n      cleanupDeadEnemies(stat);\n      if (growMsgs.length > 0) pushMessage(variables, '系统提示', growMsgs.join(' | '));\n    } catch (e) {\n      console.error('[Integrated Engine v2.3] 运行异常:', e);\n    }\n  }\n\n  eventOnFn(EVENT_ENDED, onVariableUpdateEnded);\n})();\nexport { };\n\n"],"names":["window","waitGlobalInitialized","EVT","Mvu","events","EVENT_STARTED","VARIABLE_UPDATE_STARTED","EVENT_ENDED","VARIABLE_UPDATE_ENDED","eventOnFn","eventOn","prevMoneySnapshot","pushMessage","variables","key","msg","display_data","num","v","n","parseFloat","isNaN","findItem","owner","name","bag","catKeys","c","bucket","Object","prototype","hasOwnProperty","call","money","stat_data","JSON","parse","stringify","e","JOB_LEVEL_XP_TABLE","SKILL_LEVELS","capValues","stat","p","res","r","cur","max","isFinite","cleanupEquip","ch","equip","forEach","cat","entries","slotKey","slotVal","twoHandRule","weapons","hasTwoHanded","values","weapon","item","String","hands","trim","newWeapons","k","totalAbilities","A","states","itemBonus","slot","a","attributes_bonus","t","sName","st","Math","resourceMax","hpMax","mpMax","fpMax","spMax","armor","armor_value","armorOf","FATIGUE","fatigueStates","ratio","target","have","desc","rollMod","type","level","description","special_effects","roll_modifier","COPPER_PER_SILVER","SILVER_PER_GOLD","growMsgs","wps","enemies","deferredCleanup","npc","migrateFatigue","msgOut","req","parseInt","round","push","sharedExperienceGrowth","progress","threshold","floor","attributeBreakthrough","sk","indexOf","idx","length","nxt","skillLevelUp","g","s","deficit","needS","usableS","shortageS","needCforS","deficitS","needG","ceil","needC","deficitC","needSforC","purchaseConversion","wp","normalizeCoordinates","root","hp","cleanupDeadEnemies","join","console","error"],"sourceRoot":""}