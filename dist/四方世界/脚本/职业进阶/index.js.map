{"version":3,"file":"index.js","mappings":"AACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3ER,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,ICAlF,MAAM,EAA+BI,E,aCGrC,MAAMC,EAAKC,OAAeD,EAEpBE,EAAM,CAAEC,KAAM,UAAWC,WAAY,UAuBrCC,EAAqBC,MAAOC,EAAiBC,EAAeC,EAA0BC,EAAWC,KACrG,IACE,MAAMC,EAAc,IAAKF,UAClBE,EAAYL,GAEnBK,EAAYJ,GAAS,CACnB,KAAM,EACN,KAAM,GACN,KAAM,EACN,KAAM,IACNK,iBAAkBN,EAClBO,kBAAmBL,GAGpBR,OAAec,YAAY,kBAAmBH,EAAaV,GAC3DD,OAAec,YAAY,oBAAqBJ,EAAQT,GAEzD,MAAMc,EAnCY,CAACN,GACdpB,OAAO2B,QAAQP,GAAMQ,IAAI,EAAEC,EAASC,KAClB,iBAAZA,GAAoC,OAAZA,EAC1B,GAAGD,QAAcC,EAAQ,MAAQ,UAAUA,EAAQ,MAAQ,KAAKA,EAAQ,MAAQ,OAElF,GAAGD,MAAYC,KACrBC,KAAK,MA6BUC,CAAcV,GACxBW,EA3Bc,CAACZ,GAChBrB,OAAO2B,QAAQN,GAAQO,IAAI,EAAEM,EAAWC,KACpB,iBAAdA,GAAwC,OAAdA,EAC5B,GAAGD,MAAcC,EAAUC,OAAS,cAAcD,EAAU,KAAO,WAAWA,EAAUE,YAAc,KAExG,GAAGH,MAAcC,KACvBJ,KAAK,MAqBYO,CAAgBjB,GAE5BkB,EAAqB,YAAYtB,OAAaE,UAAyBD,eAAmBC,mBAAkCO,mBAAyBO,uBAA+Bd,oCAI1L,aAFOR,OAAe6B,aAAa,QAAQD,KAC1C5B,OAAe8B,OAAOC,QAAQ,SAASxB,OACjC,CACT,CAAE,MAAOyB,GAGP,OAFAC,QAAQD,MAAM,cAAeA,GAC5BhC,OAAe8B,OAAOE,MAAM,UAAYA,EAAME,UACxC,CACT,GAGFnC,EAAE,KACCC,OAAemC,QAAQ,eAAgB9B,MAAO+B,IAC7C,GAAqB,SAAjBA,EAAKC,QACP,IACE,MAAO/B,EAASC,GAAS6B,EAAKE,KAAKC,MAAM,KACzC,IAAKjC,IAAYC,EAEf,YADCP,OAAe8B,OAAOE,MAAM,YAG/B,MAAMQ,EAAQxC,OAAeyC,aAAaxC,GACpCQ,EA/DW,CAAC+B,GAAc,QAAMA,EAAM,kBAAmB,QAAMA,EAAM,QAAS,CAAC,IA+DxEE,CAAiBF,GACxB9B,EA/Da,CAAC8B,GAAc,QAAMA,EAAM,oBAAqB,QAAMA,EAAM,UAAW,CAAC,IA+D5EG,CAAmBH,GAC5BI,EAAgBnC,EAAKH,IAAU,MAAQ,QAEvCF,EAAmBE,EAASC,EAAOqC,EAAenC,EAAMC,EAChE,CAAE,MAAOmC,GACPZ,QAAQD,MAAM,cAAea,GAC5B7C,OAAe8B,OAAOE,MAAM,gBAC/B","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/四方世界/脚本/职业进阶/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = _;","import _ from 'lodash';\r\n\r\n// ST_API functions are accessed via (window as any) currently.\r\nconst $ = (window as any).$;\r\n\r\nconst CTX = { type: 'message', message_id: 'latest' } as const;\r\n\r\nconst getCharacterJobs = (vars: any) => _.get(vars, 'stat_data.主角.职业', _.get(vars, '主角.职业', {}));\r\nconst getCharacterSkills = (vars: any) => _.get(vars, 'stat_data.主角.技能列表', _.get(vars, '主角.技能列表', {}));\r\n\r\nconst formatJobInfo = (jobs: any) => {\r\n  return Object.entries(jobs).map(([jobName, jobData]: [string, any]) => {\r\n    if (typeof jobData === 'object' && jobData !== null) {\r\n      return `${jobName}: 等级${jobData.当前等级 || 1} (经验: ${jobData.当前经验 || 0}/${jobData.升级所需 || 1000})`;\r\n    }\r\n    return `${jobName}: ${jobData}`;\r\n  }).join('\\n');\r\n};\r\n\r\nconst formatSkillInfo = (skills: any) => {\r\n  return Object.entries(skills).map(([skillName, skillData]: [string, any]) => {\r\n    if (typeof skillData === 'object' && skillData !== null) {\r\n      return `${skillName}: ${skillData.level || '初级'} (熟练度: ${skillData.熟练度 || 0}%, 效率: ${skillData.efficiency || 1})`;\r\n    }\r\n    return `${skillName}: ${skillData}`;\r\n  }).join('\\n');\r\n};\r\n\r\nconst performAdvancement = async (fromJob: string, toJob: string, previousJobLevel: number, jobs: any, skills: any) => {\r\n  try {\r\n    const updatedJobs = { ...jobs };\r\n    delete updatedJobs[fromJob];\r\n\r\n    updatedJobs[toJob] = {\r\n      当前等级: 1,\r\n      最大等级: 10,\r\n      当前经验: 0,\r\n      升级所需: 1000,\r\n      advancement_from: fromJob,\r\n      advancement_level: previousJobLevel,\r\n    };\r\n\r\n    (window as any).setVariable('stat_data.主角.职业', updatedJobs, CTX);\r\n    (window as any).setVariable('stat_data.主角.技能列表', skills, CTX);\r\n\r\n    const jobInfo = formatJobInfo(updatedJobs);\r\n    const skillInfo = formatSkillInfo(skills);\r\n\r\n    const advancementMessage = `角色职业进阶：从 ${fromJob}(等级${previousJobLevel}) 进阶为 ${toJob}\\n\\n前置职业等级：${previousJobLevel}\\n\\n当前所有职业状态：\\n${jobInfo}\\n\\n当前所有技能状态：\\n${skillInfo}\\n\\n进阶强度判断依据：前置职业等级${previousJobLevel}，请根据此信息以及当前职业和技能状态决定新职业的具体强度和特性。`;\r\n\r\n    await (window as any).triggerSlash(`/sys ${advancementMessage}`);\r\n    (window as any).toastr.success(`成功进阶为 ${toJob}！`);\r\n    return true;\r\n  } catch (error: any) {\r\n    console.error('[职业进阶] 执行失败', error);\r\n    (window as any).toastr.error('职业进阶失败：' + error.message);\r\n    return false;\r\n  }\r\n};\r\n\r\n$(() => {\r\n  (window as any).eventOn('slashCommand', async (data: any) => {\r\n    if (data.command === '职业进阶') {\r\n      try {\r\n        const [fromJob, toJob] = data.args.split(':');\r\n        if (!fromJob || !toJob) {\r\n          (window as any).toastr.error('职业进阶参数错误');\r\n          return;\r\n        }\r\n        const vars = (window as any).getVariables(CTX);\r\n        const jobs = getCharacterJobs(vars);\r\n        const skills = getCharacterSkills(vars);\r\n        const previousLevel = jobs[fromJob]?.当前等级 || 1;\r\n\r\n        await performAdvancement(fromJob, toJob, previousLevel, jobs, skills);\r\n      } catch (err) {\r\n        console.error('[职业进阶] 执行失败', err);\r\n        (window as any).toastr.error('职业进阶失败，请查看控制台');\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\nexport { };\r\n\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_","$","window","CTX","type","message_id","performAdvancement","async","fromJob","toJob","previousJobLevel","jobs","skills","updatedJobs","advancement_from","advancement_level","setVariable","jobInfo","entries","map","jobName","jobData","join","formatJobInfo","skillInfo","skillName","skillData","level","efficiency","formatSkillInfo","advancementMessage","triggerSlash","toastr","success","error","console","message","eventOn","data","command","args","split","vars","getVariables","getCharacterJobs","getCharacterSkills","previousLevel","err"],"sourceRoot":""}