var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=_;var n=t.n(e);const o='装备管理',r={type:'message',message_id:'latest'},a=(t,e)=>t?.name||t?.名称||e||'';$(()=>{(async()=>{try{await window.triggerSlash(`/buttons ${o}`)}catch(t){console.error('[装备管理] 显示按钮失败',t)}})(),window.eventOn(window.getButtonEvent(o),()=>{try{const t=(t=>n().get(t,'stat_data.主角',n().get(t,'主角',{}))||{})(window.getVariables(r)),e=(t=>{const e=t&&'object'==typeof t?n().cloneDeep(t):{};return['武器','防具','饰品'].forEach(t=>{e[t]&&'object'==typeof e[t]||(e[t]={})}),e})(t.装备),o=(t=>{const e=t&&'object'==typeof t?n().cloneDeep(t):{};return['武器','防具','饰品','消耗品','材料'].forEach(t=>{e[t]&&'object'==typeof e[t]||(e[t]={})}),e.金钱||(e.金钱={金币:0,银币:0,铜币:0}),e})(t.背包),s=window.prompt('选择操作：\n1. 一键脱衣\n2. 穿衣\n请输入数字：','1');if('1'===s){const t=((t,e)=>{let o=0;return['武器','防具','饰品'].forEach(r=>{const s=t[r]||{};Object.entries(s).forEach(([t,s])=>{if(!s||'待初始化'===s)return;const i=a(s,t);if(!i)return;const c=e[r]||(e[r]={}),u=c[i],w=u&&Number(u.quantity)||0,d=n().cloneDeep(s);d.quantity=w+1,c[i]=d,o+=1}),t[r]={}}),o})(e,o);if(0===t)return void window.toastr.info('没有可脱下的装备');window.setVariable('stat_data.主角.装备',e,r),window.setVariable('stat_data.主角.背包',o,r),window.toastr.success(`已脱下 ${t} 件装备，并移入背包`)}else if('2'===s){const t=[];if(['武器','防具','饰品'].forEach(e=>{const n=o[e]||{};Object.entries(n).forEach(([n,o])=>{const r=a(o,n),s=o.quantity||1;r&&s>0&&t.push(`${r} (${e}, 数量: ${s})`)})}),0===t.length)return void window.toastr.info('背包中没有可装备的物品');const s=window.prompt(`选择要装备的物品：\n${t.join('\n')}\n\n请输入装备名称：`,'');if(!s)return;const i=((t,e,o)=>{let r=null,s=null,i=null;for(const t of['武器','防具','饰品']){const n=e[t]||{};for(const[e,c]of Object.entries(n))if(a(c,e)===o&&(c.quantity||1)>0){r=c,s=t,i=e;break}if(r)break}if(!r)throw new Error(`背包中未找到装备: ${o}`);const c=r.part||r.部位;if(!c)throw new Error(`装备 ${o} 缺少部位信息`);const u=t[s]?.[c];if(u){const t=a(u,c),o=e[s]||(e[s]={}),r=o[t],i=r&&Number(r.quantity)||0,w=n().cloneDeep(u);w.quantity=i+1,o[t]=w}const w=t[s]||(t[s]={}),d=n().cloneDeep(r);return delete d.quantity,w[c]=d,r.quantity>1?r.quantity-=1:delete e[s][i],{equipped:o,unequipped:u?a(u,c):null}})(e,o,s.trim());window.setVariable('stat_data.主角.装备',e,r),window.setVariable('stat_data.主角.背包',o,r);let c=`已装备 ${i.equipped}`;i.unequipped&&(c+=`，替换了 ${i.unequipped}`),window.toastr.success(c)}else window.toastr.warning('无效选择')}catch(t){console.error('[装备管理] 操作失败',t),window.toastr.error('装备管理失败，请查看控制台：'+t.message)}})});
//# sourceMappingURL=index.js.map