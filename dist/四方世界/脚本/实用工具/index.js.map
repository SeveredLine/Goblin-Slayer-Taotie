{"version":3,"file":"index.js","mappings":"AACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3ER,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,ICAlF,MAAM,EAA+BI,E,aCGrC,MAAMC,EAAKC,OAAeD,EAEpBE,EAAM,CAAEC,KAAM,UAAWC,WAAY,UAErCC,EAAoB,CAACC,EAAiBC,EAAqCC,KAC/E,WACE,UACSP,OAAeQ,aAAa,YAAYH,IACjD,CAAE,MAAOI,GACPC,QAAQC,MAAM,IAAIN,YAAmBI,EACvC,CACD,EAND,GAQCT,OAAeY,QAASZ,OAAea,eAAeR,GAAU,KAC/D,IACE,MAAMS,EAAQd,OAAee,aAAad,GACpCe,EAAQV,EAAWQ,GACzB,IAAKE,EAAMC,OAET,YADCjB,OAAekB,OAAOC,KAAK,WAI9B,MAAMC,EAASpB,OAAOqB,OAAO,cAAcL,EAAMM,KAAK,OAAQN,EAAM,IACpE,IAAKI,EAAQ,OACb,MAAMG,EAAUH,EAAOI,OAGvB,IADWxB,OAAOyB,QAAQ,QAAQF,gBACzB,OAET,MAAMG,EAAOnB,EAAagB,EAAST,GACnC,IAAKY,EAEH,YADC1B,OAAekB,OAAOP,MAAM,aAI/B,MAAM,gBAAEgB,GAAqB3B,OAAe4B,eAAeF,EAAMzB,GAC7D0B,EACD3B,OAAekB,OAAOW,QAAQ,SAASN,MAEvCvB,OAAekB,OAAOY,QAAQ,iBAEnC,CAAE,MAAOrB,GACPC,QAAQC,MAAM,IAAIN,UAAiBI,GAClCT,OAAekB,OAAOP,MAAM,cAC/B,KAIJZ,EAAE,KAEAK,EAAkB,QAASU,IACzB,MAAMiB,EAAO,QAAMjB,EAAM,iBAAkB,CAAC,GAC5C,OAAOzB,OAAO2C,KAAKD,GAAME,IAAIC,IAC3B,MAAMC,EAAIJ,EAAKG,GACTE,EAAOD,GAAG,IAAMA,GAAG,IAAM,GAC/B,OAAOC,EAAO,GAAGF,KAAKE,KAAUF,KAEhCX,GAAY,kBAAkBA,EAAQc,MAAM,KAAK,MAGrDjC,EAAkB,OAAQU,IACxB,MAAMwB,EAAW,QAAMxB,EAAM,oBAAqB,CAAC,GACnD,OAAOzB,OAAO2C,KAAKM,GAAUL,IAAIC,IAC/B,MAAMK,EAAOD,EAASJ,GAEtB,MAAO,GAAGA,QADIK,GAAMC,OAASD,GAAM,IAAM,UAGzChB,GAAY,qBAAqBA,EAAQc,MAAM,KAAK,MAGxDjC,EAAkB,OAAQU,IACxB,MAAM2B,EAAS,QAAM3B,EAAM,oBAAqB,CAAC,GAC3C4B,EAAW,IAAMD,EAAO,QAAU,CAAC,KAAQA,EAAO,QAAU,CAAC,GACnE,OAAOpD,OAAO2C,KAAKU,IAClB,CAACnB,EAAST,KACX,MAAM2B,EAAS,QAAM3B,EAAM,oBAAqB,CAAC,GACjD,OAAI2B,EAAO,QAAUA,EAAO,OAAOlB,GAAiB,yBAAyBA,IACzEkB,EAAO,QAAUA,EAAO,OAAOlB,GAAiB,yBAAyBA,IACtE","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/四方世界/脚本/实用工具/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = _;","import _ from 'lodash';\n\n// ST_API functions are accessed via (window as any) currently.\nconst $ = (window as any).$;\n\nconst CTX = { type: 'message', message_id: 'latest' } as const;\n\nconst setupDeleteButton = (btnName: string, getItemsFn: (vars: any) => string[], deletePathFn: (item: string, vars: any) => string) => {\n  (async () => {\n    try {\n      await (window as any).triggerSlash(`/buttons ${btnName}`);\n    } catch (err) {\n      console.error(`[${btnName}] 显示按钮失败`, err);\n    }\n  })();\n\n  (window as any).eventOn((window as any).getButtonEvent(btnName), () => {\n    try {\n      const vars = (window as any).getVariables(CTX);\n      const items = getItemsFn(vars);\n      if (!items.length) {\n        (window as any).toastr.info(`暂无内容可删除`);\n        return;\n      }\n      \n      const picked = window.prompt(`输入要删除的键名：\\n${items.join('，')}`, items[0]);\n      if (!picked) return;\n      const trimmed = picked.trim();\n      \n      const ok = window.confirm(`确定删除「${trimmed}」吗？此操作不可撤销。`);\n      if (!ok) return;\n\n      const path = deletePathFn(trimmed, vars);\n      if (!path) {\n        (window as any).toastr.error('无法定位该项目路径');\n        return;\n      }\n\n      const { delete_occurred } = (window as any).deleteVariable(path, CTX);\n      if (delete_occurred) {\n        (window as any).toastr.success(`已成功删除「${trimmed}」`);\n      } else {\n        (window as any).toastr.warning('删除失败，可能该项目已被删除');\n      }\n    } catch (err) {\n      console.error(`[${btnName}] 删除失败`, err);\n      (window as any).toastr.error('删除失败，请查看控制台');\n    }\n  });\n};\n\n$(() => {\n  // 删除NPC\n  setupDeleteButton('删除NPC', vars => {\n    const rels = _.get(vars, 'stat_data.关系列表', {});\n    return Object.keys(rels).map(k => {\n      const r = rels[k];\n      const name = r?.姓名 || r?.名称 || '';\n      return name ? `${k}（${name}）` : k;\n    });\n  }, (trimmed) => `stat_data.关系列表.${trimmed.split('（')[0]}`);\n\n  // 删除状态\n  setupDeleteButton('删除状态', vars => {\n    const statuses = _.get(vars, 'stat_data.主角.当前状态', {});\n    return Object.keys(statuses).map(k => {\n      const data = statuses[k];\n      const level = data?.level || data?.等级 || '?';\n      return `${k}（Lv.${level}）`;\n    });\n  }, (trimmed) => `stat_data.主角.当前状态.${trimmed.split('（')[0]}`);\n\n  // 删除任务\n  setupDeleteButton('删除任务', vars => {\n    const quests = _.get(vars, 'stat_data.主角.任务日志', {});\n    const allTasks = { ...(quests['进行中'] || {}), ...(quests['已完成'] || {}) };\n    return Object.keys(allTasks);\n  }, (trimmed, vars) => {\n    const quests = _.get(vars, 'stat_data.主角.任务日志', {});\n    if (quests['进行中'] && quests['进行中'][trimmed]) return `stat_data.主角.任务日志.进行中.${trimmed}`;\n    if (quests['已完成'] && quests['已完成'][trimmed]) return `stat_data.主角.任务日志.已完成.${trimmed}`;\n    return '';\n  });\n});\n\nexport { };\n\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_","$","window","CTX","type","message_id","setupDeleteButton","btnName","getItemsFn","deletePathFn","triggerSlash","err","console","error","eventOn","getButtonEvent","vars","getVariables","items","length","toastr","info","picked","prompt","join","trimmed","trim","confirm","path","delete_occurred","deleteVariable","success","warning","rels","keys","map","k","r","name","split","statuses","data","level","quests","allTasks"],"sourceRoot":""}