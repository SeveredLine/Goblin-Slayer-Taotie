import{registerMvuSchema as r}from'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var a in t)e.o(t,a)&&!e.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:t[a]})},o:(r,e)=>Object.prototype.hasOwnProperty.call(r,e)};const t=_;var a=e.n(t);const n=z,u=[{rank:'白金',cv:1/0},{rank:'金',cv:3e3},{rank:'银',cv:2450},{rank:'青铜',cv:1650},{rank:'红玉',cv:1050},{rank:'翠玉',cv:600},{rank:'青玉',cv:300},{rank:'钢铁',cv:200},{rank:'黑曜石',cv:100},{rank:'白瓷',cv:0}],l=['初级','中级','高级','精通','大师'],c={初级:1,中级:.8,高级:.5,精通:.25,大师:.1},o=(r,e)=>{const t=r.最大值||0,a=Math.max(0,e),n=r.当前值;if(0===t||null===n)return r.最大值=a,void(r.当前值=a);if(a!==t){const e=a-t;r.最大值=a;let u=(n||0)+e;u=Math.max(0,Math.min(a,u)),r.当前值=u}else n>a&&(r.当前值=a)},f=r=>{if(!r||'string'!=typeof r)return'白瓷';const e=r.replace(/级$/,'').replace(/等级$/,''),t={黄金:'金',黄金级:'金',金级:'金',黄金等级:'金',金等级:'金',白银:'银',白银级:'银',银级:'银',白银等级:'银',银等级:'银',黑曜:'黑曜石',黑曜级:'黑曜石',黑曜石级:'黑曜石',黑曜等级:'黑曜石',黑曜石等级:'黑曜石',白金级:'白金',青铜级:'青铜',红玉级:'红玉',翠玉级:'翠玉',青玉级:'青玉',钢铁级:'钢铁',白瓷级:'白瓷',白金等级:'白金',青铜等级:'青铜',红玉等级:'红玉',翠玉等级:'翠玉',青玉等级:'青玉',钢铁等级:'钢铁',白瓷等级:'白瓷',准金级:'准金级',准金:'准金级'};if(t[e])return t[e];return u.find(r=>r.rank===e)?e:'白瓷'},p=n.z.object({name:n.z.string().prefault('未命名物品'),type:n.z.string().prefault('杂物'),tier:n.z.string().prefault('普通'),part:n.z.string().prefault(''),description:n.z.string().prefault(''),armor_value:n.z.coerce.number().prefault(0),attributes_bonus:n.z.record(n.z.string(),n.z.coerce.number()).prefault({}),hands:n.z.string().prefault('单手'),special_effects:n.z.record(n.z.string(),n.z.string()).prefault({}),quantity:n.z.coerce.number().prefault(1)}).or(n.z.literal('待初始化')).prefault('待初始化'),s=(r=null)=>n.z.object({当前值:n.z.coerce.number().nullable().prefault(r),最大值:n.z.coerce.number().nullable().prefault(r)}).prefault({}),i=n.z.object({武器:n.z.record(n.z.string(),p).prefault({}),防具:n.z.record(n.z.string(),p).prefault({}),饰品:n.z.record(n.z.string(),p).prefault({}),消耗品:n.z.record(n.z.string(),p).prefault({}),材料:n.z.record(n.z.string(),p).prefault({}),杂物:n.z.record(n.z.string(),p).prefault({}),金钱:n.z.object({金币:n.z.coerce.number().prefault(0),银币:n.z.coerce.number().prefault(0),铜币:n.z.coerce.number().prefault(0)}).prefault({})}).prefault({}),m=n.z.object({力量:n.z.coerce.number().transform(r=>Math.max(0,Math.min(100,r))).prefault(0),敏捷:n.z.coerce.number().transform(r=>Math.max(0,Math.min(100,r))).prefault(0),感知:n.z.coerce.number().transform(r=>Math.max(0,Math.min(100,r))).prefault(0),知识:n.z.coerce.number().transform(r=>Math.max(0,Math.min(100,r))).prefault(0),魅力:n.z.coerce.number().transform(r=>Math.max(0,Math.min(100,r))).prefault(0),魔力:n.z.coerce.number().transform(r=>Math.max(0,Math.min(100,r))).prefault(0),信仰力:n.z.coerce.number().transform(r=>Math.max(0,Math.min(100,r))).prefault(0)}).prefault({}),b=n.z.object({世界:n.z.object({当前时间:n.z.string().prefault('战后十年/初醒之月/第一日'),世界动向:n.z.string().prefault('暂无重大动向'),城市趣闻:n.z.string().prefault('暂无趣闻'),冒险逸闻:n.z.string().prefault('暂无逸闻')}).prefault({}),主角:n.z.object({姓名:n.z.string().prefault('{{user}}'),所在地:n.z.string().nullable().prefault(null),坐标:n.z.object({x:n.z.coerce.number().prefault(0),y:n.z.coerce.number().prefault(0)}).prefault({}),职业:n.z.record(n.z.string(),n.z.object({当前等级:n.z.coerce.number().prefault(1),最大等级:n.z.coerce.number().prefault(10),当前经验:n.z.coerce.number().prefault(0),升级所需:n.z.coerce.number().prefault(1e3)}).or(n.z.literal('待初始化'))).prefault({}),经验等级:n.z.coerce.number().prefault(1),技能点:n.z.coerce.number().prefault(0),种族:n.z.string().nullable().prefault('人类'),能力:n.z.object({力量:n.z.coerce.number().transform(r=>Math.max(0,r)).prefault(5),敏捷:n.z.coerce.number().transform(r=>Math.max(0,r)).prefault(5),感知:n.z.coerce.number().transform(r=>Math.max(0,r)).prefault(5),知识:n.z.coerce.number().transform(r=>Math.max(0,r)).prefault(5),魅力:n.z.coerce.number().transform(r=>Math.max(0,r)).prefault(5),魔力:n.z.coerce.number().transform(r=>Math.max(0,r)).prefault(0),信仰力:n.z.coerce.number().transform(r=>Math.max(0,r)).prefault(0)}).prefault({}),生命值:s(),护甲值:s(0),魔力值:s(),信仰力值:s(),体力值:s(),历练进度:m,装备:n.z.object({武器:n.z.record(n.z.string(),p).prefault({}),防具:n.z.record(n.z.string(),p).prefault({}),饰品:n.z.record(n.z.string(),p).transform(r=>{const e=a().entries(r).filter(([_,r])=>'戒指'===r?.type);if(e.length>2){const t=e.slice(0,e.length-2).map(([r])=>r);return a().omit(r,t)}return r}).prefault({})}).prefault({}),技能列表:n.z.record(n.z.string(),n.z.object({type:n.z.string().prefault('主动'),tier:n.z.string().prefault('T1'),level:n.z.string().prefault('初级'),熟练度:n.z.coerce.number().transform(r=>a().clamp(r,0,100)).prefault(0),efficiency:n.z.coerce.number().prefault(1),description:n.z.string().prefault(''),effect:n.z.string().prefault(''),cost:n.z.string().prefault('')}).or(n.z.literal('待初始化'))).prefault({}),资产:n.z.record(n.z.string(),n.z.object({名称:n.z.string().prefault(''),位置:n.z.string().prefault(''),整体介绍:n.z.string().prefault(''),内部结构布局:n.z.string().prefault('')}).or(n.z.literal('待初始化'))).prefault({}),当前状态:n.z.record(n.z.string(),n.z.object({description:n.z.string().prefault(''),level:n.z.string().prefault('1'),attributes_bonus:n.z.record(n.z.string(),n.z.coerce.number()).prefault({}),type:n.z.string().prefault('临时')}).or(n.z.literal('待初始化'))).prefault({}),任务日志:n.z.object({进行中:n.z.record(n.z.string(),n.z.any()).prefault({}),已完成:n.z.record(n.z.string(),n.z.any()).prefault({})}).prefault({}),背包:i,公会信息:n.z.object({所属公会:n.z.string().prefault('无'),公会阶级:n.z.string().transform(r=>f(r)).prefault('白瓷'),当前贡献度:n.z.coerce.number().prefault(0)}).prefault({})}).transform(r=>{(r=(r=>{let e=r.技能点||0;const t=r.职业||{};let n=0;return a().forOwn(t,r=>{if(r&&'object'==typeof r&&'待初始化'!==r){r.升级所需&&0!==r.升级所需||(r.升级所需=1e3);const t=r.当前等级||1,a=r.最大等级||10;let u=0,l=r.当前经验||0,c=r.升级所需;for(;l>=c&&t+u<a;)u++,l-=c,c+=1e3;u>0&&(r.当前等级=t+u,r.当前经验=Math.max(0,l),r.升级所需=c,e+=u,n+=u)}}),r.技能点=e,n>0&&(r.经验等级=(r.经验等级||1)+n),r})(r=(r=>(['力量','敏捷','感知','知识','魅力','魔力','信仰力'].forEach(e=>{if(r.历练进度&&void 0!==r.历练进度[e]&&r.历练进度[e]>=100){const t=r.能力[e]||0;r.能力[e]=t+1,r.历练进度[e]=0}}),r))(r))).公会信息.公会阶级=f(r.公会信息.公会阶级),a().forOwn(r.技能列表,r=>{if(r&&'object'==typeof r&&'待初始化'!==r){if(r.熟练度>=100){const e=l.indexOf(r.level);-1!==e&&e<l.length-1?(r.level=l[e+1],r.熟练度=0):r.熟练度=100}r.efficiency=c[r.level]??1}});const e=r.能力;o(r.生命值,10+5*(e.力量||0)+2*(e.感知||0)),o(r.体力值,5+(e.敏捷||0)+(e.力量||0)),o(r.魔力值,e.魔力||0),o(r.信仰力值,e.信仰力||0);const t=[...a().values(r.装备.武器),...a().values(r.装备.防具),...a().values(r.装备.饰品)].reduce((r,e)=>r+(e?.armor_value||0),0);return r.护甲值.最大值=t,null===r.护甲值.当前值&&(r.护甲值.当前值=t),r}).prefault({}),关系列表:n.z.record(n.z.string(),n.z.object({姓名:n.z.string().prefault(''),职业:n.z.union([n.z.string(),n.z.record(n.z.string(),n.z.any())]).prefault('未知'),职业等级:n.z.coerce.number().prefault(1),种族:n.z.string().prefault(''),is_companion:n.z.boolean().prefault(!1),在场:n.z.boolean().prefault(!1),好感度:n.z.union([n.z.coerce.number(),n.z.record(n.z.string(),n.z.coerce.number())]).prefault(0),信任度:n.z.union([n.z.coerce.number(),n.z.record(n.z.string(),n.z.coerce.number())]).prefault(0),能力:n.z.object({力量:n.z.coerce.number().prefault(5),敏捷:n.z.coerce.number().prefault(5),感知:n.z.coerce.number().prefault(5),知识:n.z.coerce.number().prefault(5),魅力:n.z.coerce.number().prefault(5),魔力:n.z.coerce.number().prefault(0),信仰力:n.z.coerce.number().prefault(0)}).prefault({}),装备:n.z.object({武器:n.z.record(n.z.string(),p).prefault({}),防具:n.z.record(n.z.string(),p).prefault({}),饰品:n.z.record(n.z.string(),p).prefault({})}).prefault({}),背包:i,技能列表:n.z.record(n.z.string(),n.z.any()).prefault({}),生命值:s(),护甲值:s(0),魔力值:s(),信仰力值:s(),体力值:s(),公会信息:n.z.object({所属公会:n.z.string().prefault('无'),公会阶级:n.z.string().transform(r=>f(r)).prefault('无阶级'),当前贡献度:n.z.coerce.number().prefault(0)}).prefault({}),身份背景:n.z.string().prefault(''),性格标签:n.z.record(n.z.string(),n.z.boolean()).prefault({}),外貌:n.z.string().prefault(''),称呼:n.z.string().prefault(''),与主角关系:n.z.string().prefault(''),层级:n.z.string().transform(r=>(r=>{if(!r||'string'!=typeof r)return'白瓷';const e=r.replace(/级$/,'').replace(/等级$/,''),t={白瓷:'白瓷',黑曜石:'黑曜石',青玉:'青玉',翠玉:'翠玉',红玉:'红玉',青铜:'青铜',白银:'白银',黄金:'黄金',白金:'白金',准金级:'准金级',准金:'准金级'};if(t[e])return t[e];for(const[r,a]of Object.entries(t))if(e.includes(r)||r.includes(e))return a;return'白瓷'})(r)).prefault('白瓷'),历练进度:m,性档案:n.z.object({私处叙述:n.z.string().prefault(''),阴道结构叙述:n.z.string().prefault(''),体位及次数:n.z.record(n.z.string(),n.z.coerce.number()).prefault({}),技巧评价:n.z.string().prefault(''),与主角意愿:n.z.string().prefault(''),通用性癖好:n.z.string().prefault(''),受孕与内射意愿:n.z.string().prefault('')}).prefault({}),所处地点:n.z.string().prefault(''),重要记忆:n.z.record(n.z.string(),n.z.string()).prefault({})}).transform(r=>{if(r.能力){const e=r.能力;o(r.生命值,10+5*(e.力量||0)+2*(e.感知||0)),o(r.体力值,5+(e.敏捷||0)+(e.力量||0)),o(r.魔力值,e.魔力||0),o(r.信仰力值,e.信仰力||0)}if(r.装备){const e=[...a().values(r.装备.武器),...a().values(r.装备.防具),...a().values(r.装备.饰品)].reduce((r,e)=>r+(e?.armor_value||0),0);r.护甲值.最大值=e,null===r.护甲值.当前值&&(r.护甲值.当前值=e)}return r.公会信息&&r.公会信息.公会阶级&&(r.公会信息.公会阶级=f(r.公会信息.公会阶级)),r}).or(n.z.literal('待初始化'))).prefault({}),敌人列表:n.z.record(n.z.string(),n.z.object({类型:n.z.string().prefault('人形'),生命值:s(),护甲值:s(0),能力:n.z.record(n.z.string(),n.z.coerce.number()).prefault({}),备注:n.z.string().prefault('')}).transform(r=>(null===r.生命值.当前值&&null!==r.生命值.最大值&&(r.生命值.当前值=r.生命值.最大值),r)).or(n.z.literal('待初始化'))).prefault({}),地图位标:n.z.record(n.z.string(),n.z.object({名称:n.z.string().nullable().prefault(null),坐标:n.z.object({x:n.z.coerce.number().prefault(0),y:n.z.coerce.number().prefault(0)}).prefault({}),类型:n.z.string().prefault('调查'),临时:n.z.boolean().prefault(!1),概况:n.z.string().nullable().prefault(null)}).or(n.z.literal('待初始化'))).prefault({})});(0,window.$)(()=>{r(b)});
//# sourceMappingURL=index.js.map