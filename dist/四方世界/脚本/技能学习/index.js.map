{"version":3,"file":"index.js","mappings":"AACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3ER,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,ICAlF,MAAM,EAA+BI,E,aCGrC,MAAMC,EAAKC,OAAeD,EAEpBE,EAAW,OACXC,EAAM,CAAEC,KAAM,UAAWC,WAAY,UAa3CL,EAAE,KACA,WACE,UACSC,OAAeK,aAAa,YAAYJ,IACjD,CAAE,MAAOK,GACPC,QAAQC,MAAM,gBAAiBF,EACjC,CACD,EAND,GAQCN,OAAeS,QAAST,OAAeU,eAAeT,GAAWU,UAChE,IACE,MAAMC,EAAQZ,OAAea,aAAaX,GACpCY,EAvBW,CAACF,IACtB,MAAMG,EAAI,QAAMH,EAAM,mBAAoB,QAAMA,EAAM,SAAU,IAChE,OAAOI,OAAOD,IAAM,GAqBDE,CAAeL,GACxBM,EAnBU,CAACN,GACjB,QAAMA,EAAM,oBAA4B,mBACxC,QAAMA,EAAM,UAAkB,SAC3B,mBAgBgBO,CAAcP,GACjC,GAAIE,GAAU,EAEZ,YADCd,OAAeoB,OAAOC,QAAQ,iBAIjC,MAAMC,EAAYtB,OAAOuB,OAAO,iBAAkB,IAClD,IAAKD,EAAW,OAEhB,MAAME,EAAY,qBAAqBF,IAEvC,GADgB,QAAMV,EAAMY,GAG1B,YADCxB,OAAeoB,OAAOK,KAAK,MAAMH,gBAIpC,MAAMI,EAAO1B,OAAOuB,OAAO,eAAgB,KAAO,GAG5CI,EAAW,CACfxB,KAAM,KACNyB,MAAO,KACP,IAAK,EACLC,WAAY,EACZC,YAAaJ,EACbK,KARW/B,OAAOuB,OAAO,eAAgB,MAAQ,KAWlDvB,OAAegC,YAAYd,EAAYe,KAAKC,IAAI,EAAGpB,EAAS,GAAIZ,GAChEF,OAAegC,YAAYR,EAAWG,EAAUzB,GAEhDF,OAAeoB,OAAOe,QAAQ,SAASb,cAC1C,CAAE,MAAOhB,GACPC,QAAQC,MAAM,cAAeF,GAC5BN,OAAeoB,OAAOZ,MAAM,gBAC/B","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/四方世界/脚本/技能学习/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = _;","import _ from 'lodash';\r\n\r\n// ST_API functions are accessed via (window as any) currently.\r\nconst $ = (window as any).$;\r\n\r\nconst BTN_NAME = '技能学习';\r\nconst CTX = { type: 'message', message_id: 'latest' } as const;\r\n\r\nconst getSkillPoints = (vars: any) => {\r\n  const v = _.get(vars, 'stat_data.主角.技能点', _.get(vars, '主角.技能点', 0));\r\n  return Number(v) || 0;\r\n};\r\n\r\nconst getPointsPath = (vars: any) => {\r\n  if (_.has(vars, 'stat_data.主角.技能点')) return 'stat_data.主角.技能点';\r\n  if (_.has(vars, '主角.技能点')) return '主角.技能点';\r\n  return 'stat_data.主角.技能点';\r\n};\r\n\r\n$(() => {\r\n  (async () => {\r\n    try {\r\n      await (window as any).triggerSlash(`/buttons ${BTN_NAME}`);\r\n    } catch (err) {\r\n      console.error('[技能学习] 显示按钮失败', err);\r\n    }\r\n  })();\r\n\r\n  (window as any).eventOn((window as any).getButtonEvent(BTN_NAME), async () => {\r\n    try {\r\n      const vars = (window as any).getVariables(CTX);\r\n      const points = getSkillPoints(vars);\r\n      const pointsPath = getPointsPath(vars);\r\n      if (points <= 0) {\r\n        (window as any).toastr.warning('技能点不足，无法学习新技能');\r\n        return;\r\n      }\r\n\r\n      const skillName = window.prompt('输入要学习的技能名（键名）：', '');\r\n      if (!skillName) return;\r\n\r\n      const skillPath = `stat_data.主角.技能列表.${skillName}`;\r\n      const existed = _.get(vars, skillPath);\r\n      if (existed) {\r\n        (window as any).toastr.info(`技能「${skillName}」已存在，未消耗技能点`);\r\n        return;\r\n      }\r\n\r\n      const desc = window.prompt('输入技能描述（可留空）：', '') || '';\r\n      const cost = window.prompt('输入技能消耗（可留空）：', '无') || '无';\r\n\r\n      const newSkill = {\r\n        type: '主动',\r\n        level: '初级',\r\n        熟练度: 0,\r\n        efficiency: 1,\r\n        description: desc,\r\n        cost,\r\n      };\r\n\r\n      (window as any).setVariable(pointsPath, Math.max(0, points - 1), CTX);\r\n      (window as any).setVariable(skillPath, newSkill, CTX);\r\n\r\n      (window as any).toastr.success(`已学习技能「${skillName}」，消耗 1 技能点`);\r\n    } catch (err) {\r\n      console.error('[技能学习] 学习失败', err);\r\n      (window as any).toastr.error('学习技能失败，请查看控制台');\r\n    }\r\n  });\r\n});\r\n\r\nexport { };\r\n\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_","$","window","BTN_NAME","CTX","type","message_id","triggerSlash","err","console","error","eventOn","getButtonEvent","async","vars","getVariables","points","v","Number","getSkillPoints","pointsPath","getPointsPath","toastr","warning","skillName","prompt","skillPath","info","desc","newSkill","level","efficiency","description","cost","setVariable","Math","max","success"],"sourceRoot":""}